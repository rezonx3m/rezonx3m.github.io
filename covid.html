<html>
<head>
    <meta charset="utf-8"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script>

        function stringToColor(str) {
            var hash = 0;
            for (var i = 0; i < str.length; i++) {
                hash = str.charCodeAt(i) + ((hash << 5) - hash);
            }
            var c = (hash & 0x00FFFFFF)
                .toString(16)
                .toUpperCase();

            return "#" + "00000".substring(0, 6 - c.length) + c;
        }


        function getColor(str) {
            switch (str) {
                case "Russia":
                    return "#D52A1D";
                case "Italy":
                    return "#009246";
                case "China":
                    return "#FFFF00";
                case "Spain":
                    return "#FABD00";
                case "Germany":
                    return "#000000";
                case "France":
                    return "#012294";
                case "United States":
                    return "#FF69B4";
                default:
                    return stringToColor(str)
            }

        }

    </script>

    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }

        body {
            background-color: #EAEAEA;
        }
    </style>
</head>


<body>
<div style="width: 100%">
    <canvas id="canvas1"></canvas>

</div>
<br><br>
<div style="width: 100%">
    <canvas id="canvas2"></canvas>

</div>
<br><br>

<div style="width: 100%">
    <canvas id="canvas3"></canvas>
</div>

<script>


    window.onload = function () {
        var datasets1 = [];
        var datasets2 = [];
        var datasets3 = [];
        $.getJSON("https://covid.2gis.ru/covid19-global-history.json", function (json) {
            var rusLenght = 0;
            for (let prop in json) {
                if (prop == "Russia") {
                    rusLenght = json[prop].confirmed.length
                }
            }

            for (let prop in json) {
                var item1 = {
                    label: prop,
                    data: json[prop].confirmed,
                    backgroundColor: getColor(prop),
                    borderColor: getColor(prop),

                    fill: false
                }


                var item2 = {
                    label: prop,
                    data: json[prop].confirmed_inc,
                    backgroundColor: getColor(prop),
                    borderColor: getColor(prop),

                    fill: false
                }

                var confirmed = json[prop].confirmed;
                var dataset = [];
                for (j = 0; j < confirmed.length; j++) {
                    if (j > 0) {
                        dataset.push(((confirmed[j] - confirmed[j - 1]) / confirmed[j] * 100).toFixed(2))
                    }
                }
                var item3 = {
                    label: prop,
                    data: dataset,
                    backgroundColor: getColor(prop),
                    borderColor: getColor(prop),

                    fill: false
                }


                if (prop == "Russia") {
                    item1.borderWidth = 15;
                    item2.borderWidth = 15;
                    item3.borderWidth = 15;
                } else {
                    item1.borderWidth = 5;
                    item2.borderWidth = 5;
                    item3.borderWidth = 5;
                }

                datasets1.push(item1);
                datasets2.push(item2);
                datasets3.push(item3);
            }


            var labels = [];
            for (let i = 1; i <= rusLenght + 2; i++) {
                labels.push(i.toString());
            }

            var config = {
                type: 'line',

                data: {
                    labels: labels,
                    datasets: datasets1
                },
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        text: 'Количество зараженных'
                    },
                    tooltips: {
                        mode: 'index',
                        intersect: false,
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                    scales: {
                        xAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Номер дня, после того, как заразилось 100 человек'
                            }
                        }],
                        yAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'кол-во человек'
                            }
                        }]
                    }
                }
            };


            var ctx = document.getElementById('canvas1').getContext('2d');
            window.myLine = new Chart(ctx, config);

            ///////////////////////


            config = {
                type: 'line',

                data: {
                    labels: labels,
                    datasets: datasets2
                },
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        text: 'Количество новых зараженных'
                    },
                    tooltips: {
                        mode: 'index',
                        intersect: false,
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                    scales: {
                        xAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Номер дня, после того, как заразилось 100 человек'
                            }
                        }],
                        yAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'кол-во человек'
                            }
                        }]
                    }
                }
            };


            ctx = document.getElementById('canvas2').getContext('2d');
            window.myLine = new Chart(ctx, config);


            ///////////////////////


            config = {
                type: 'line',

                data: {
                    labels: labels,
                    datasets: datasets3
                },
                options: {
                    responsive: true,
                    title: {
                        display: true,
                        text: 'Скорость распростронения в % относительно предыдущего дня'
                    },
                    tooltips: {
                        mode: 'index',
                        intersect: false,
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                    scales: {
                        xAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: 'Номер дня, после того, как заразилось 100 человек'
                            }
                        }],
                        yAxes: [{
                            display: true,
                            scaleLabel: {
                                display: true,
                                labelString: '% '
                            }
                        }]
                    }
                }
            };


            ctx = document.getElementById('canvas3').getContext('2d');
            window.myLine = new Chart(ctx, config);


        });


    }
    ;


</script>
</body>
</html>
